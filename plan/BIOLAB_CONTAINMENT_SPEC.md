# Bio Lab Containment 게임 상세 명세서 (에이전트 비고려, 순수 게임 설계)

## 1. 요약
`Bio Lab Containment`는 턴 기반 전략 시뮬레이션이다.
플레이어는 연구소 운영 책임자로서 오염 확산을 억제하고, 제한 자원으로 핵심 구역을 보호하며, 주어진 턴 내에 "안정화 조건"을 달성해야 한다.

- 장르: 턴제 전략/위기관리
- 플레이 타임: 1회 10~20분
- 승리 조건: 오염 지수 안정화 + 핵심 시설 생존
- 패배 조건: 연구소 붕괴 임계치 초과 or 핵심 시설 상실

## 2. 코어 플레이 루프
1. 현재 턴 상태 확인 (오염도, 자원, 시설 상태, 이벤트)
2. 행동 포인트(AP) 내에서 액션 선택
3. 턴 종료
4. 오염 확산/2차 사고/시설 효과 자동 처리
5. 다음 턴으로 진행

핵심 재미는 "지금 막을 곳"과 "포기할 곳"을 구분하는 우선순위 결정이다.

## 3. 월드/맵 구성
- 맵: 2D 타일 그리드 (기본 12x12)
- 타일 타입:
  - `Lab`(일반 실험실)
  - `Critical`(핵심 시설: 전력, 공조, 데이터센터 등)
  - `Corridor`(복도)
  - `Airlock`(격리문)
  - `Waste`(폐기물 처리 구역)
- 인접 규칙: 상하좌우 4방향 확산 (대각선 없음)
- 초기 배치: 라운드마다 시드 기반 랜덤 + 최소 보장 규칙(핵심시설 3개 이상)

## 4. 상태 시스템
### 4.1 타일 상태
- `contamination`: 0~100
- `sealed`: 격리 여부
- `fire`: 화재 여부
- `powered`: 전력 연결 여부
- `durability`: 0~100 (시설 내구도)

### 4.2 글로벌 상태
- `turn`: 현재 턴
- `maxTurn`: 제한 턴
- `ap`: 턴당 행동 포인트
- `budget`: 운영 자금
- `reagent`: 정화 약품
- `droneCount`: 사용 가능 드론 수
- `panic`: 연구소 위기 지수 (0~100)

## 5. 액션(플레이어 명령) 규격
### 5.1 액션 목록
- `Sample(zone)`
  - 효과: 오염도/원인 정보 공개(불확실성 감소), 비용 소모 적음
- `SealDoor(airlock)`
  - 효과: 해당 경계 확산 차단, 이동/운영 패널티 발생
- `Purify(zone, intensity)`
  - 효과: 오염도 감소, 약품 많이 소모
- `DeployBot(zone, mode)`
  - 효과: 2~3턴 자동 작업(정화/수리/정찰 중 선택)
- `QuarantineZone(zoneCluster)`
  - 효과: 구역 단위 봉쇄, 강력한 확산 억제 + 큰 운영 손실
- `RestorePower(critical)`
  - 효과: 핵심시설 기능 복구, AP/예산 소모 큼
- `EmergencyVent(zone)`
  - 효과: 즉시 오염도 크게 감소, 인접 구역 오염 급증 리스크

### 5.2 액션 공통 규칙
- 모든 액션은 AP 소모
- 자원 부족 시 액션 불가
- 동일 턴에 중복 실행 가능하나 점감 효율 적용 가능
- 턴 종료 후 확산 단계에서 결과 반영

## 6. 오염 확산/사건 규칙
### 6.1 확산 공식(기본)
- 각 오염 타일은 인접 타일에 확산 시도:
  - `spreadChance = baseSpread(0.25) * tileModifier * eventModifier`
  - 성공 시 인접 타일 contamination +`5~15`
- `sealed=true` 경계는 확산 차단
- 화재 타일은 확산 보정치 +50%

### 6.2 2차 사고
- contamination > 80 타일은 매 턴:
  - 화재 발생 확률
  - 설비 내구도 하락
  - panic 증가
- 핵심시설 오염 > 60이면 기능 저하 시작

### 6.3 랜덤 이벤트
- 턴당 1회 이벤트 롤:
  - 약품 누출, 전력 이상, 공조 장애, 외부 지원 도착
- 난이도에 따라 유해 이벤트 확률 상승

## 7. 승패 조건
### 7.1 승리
다음 조건을 `연속 3턴` 유지:
- 전체 평균 오염도 <= 25
- 핵심시설 파괴 0개
- panic <= 40

### 7.2 패배
- 핵심시설 파괴 2개 이상
- panic >= 100
- maxTurn 도달 시 안정화 실패

## 8. 난이도/모드
- `Easy`: AP 7, 초기 오염 낮음, 유해 이벤트 적음
- `Normal`(기본): AP 6, 균형형
- `Hard`: AP 5, 초기 오염 높음, 이벤트 가혹
- 시나리오 모드:
  - `Outbreak`(확산 중심)
  - `Power Crisis`(전력/복구 중심)
  - `Chain Reaction`(2차 사고 중심)

## 9. UI/UX 요구사항
- 좌측: 그리드 맵 + 타일 상태 오버레이(오염도 히트맵)
- 우측: 액션 패널(AP/자원/예산 표시)
- 하단: 이벤트 로그 + 턴 결과 리포트
- 필수 시각 규칙:
  - 오염도 색상 단계(녹색->황색->적색)
  - 봉쇄 경계 시각화
  - 핵심시설 경고 애니메이션
- 입력: 마우스 중심 + 단축키(턴 종료, 액션 반복)

## 10. 공개 인터페이스/타입(게임 엔진 기준)
- `GameState`
  - map, globalResources, turnInfo, incidents, winLoseStatus
- `ActionCommand`
  - type, target, params
- `ActionResult`
  - success, cost, deltas, messages
- `TickResult`
  - spreadSummary, incidentSummary, updatedState
- 핵심 함수:
  - `initGame(seed, difficulty, scenario): GameState`
  - `getValidActions(state): ActionCommand[]`
  - `applyAction(state, cmd): ActionResult`
  - `endTurn(state): TickResult`
  - `checkVictory(state): WinLoseStatus`

## 11. 테스트 케이스/시나리오
1. 봉쇄문 설치 시 경계 확산이 0으로 유지되는지
2. 오염도 80+ 타일의 2차 사고 확률이 스펙대로 동작하는지
3. 핵심시설 오염 임계치 초과 시 기능 저하가 즉시 반영되는지
4. 자원 부족 시 액션 불가 처리 및 메시지 노출
5. 승리 조건(연속 3턴) 카운팅 정확성
6. 패배 조건 panic=100 즉시 종료
7. 난이도별 초기값/AP 차이 검증
8. 동일 시드에서 동일 결과 재현(결정론)
9. 대량 확산 턴에서도 프레임 드랍 없이 턴 처리 완료
10. 저장/불러오기 후 상태 완전 일치

## 12. 가정 및 기본값(결정 완료)
- 플랫폼: PC 우선(웹 데스크톱)
- 턴제 고정(실시간 모드 없음)
- 멀티플레이/경쟁 요소 없음(싱글플레이)
- 메타 진행(영구 업그레이드) 없음, 1회성 시나리오 중심
- 밸런스 기본값: `Normal` 기준으로 12~15턴 내 안정화 가능하도록 설계
- 확률 시스템은 완전 랜덤이 아닌 시드 기반 PRNG 사용
